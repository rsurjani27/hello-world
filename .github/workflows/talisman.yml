name: Talisman Security Scan

on:
  pull_request:
    branches:
      - '**'  # This will run on pull requests to any branch

jobs:
  talisman:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Talisman Scan
      uses: thoughtworks/talisman-action@v1
      continue-on-error: true
      id: talisman

    - name: Check Talisman Result
      run: |
        if [ "${{ steps.talisman.outcome }}" == "failure" ]; then
          echo "::warning::Talisman found potential security issues. Please check the scan results."
        else
          echo "Talisman scan passed successfully."
        fi

    - name: Upload Talisman Report
      if: steps.talisman.outcome == 'failure'
      uses: actions/upload-artifact@v3
      with:
        name: talisman-report
        path: talisman.scan.log
